# NuCitrus_scripts: Nanopore Sequence Processing and T-DNA Insertion Site Identification

This repository contains the Bash scripts used for the bioinformatic analysis of Nanopore sequencing data in the context of our upcoming publication. These scripts illustrate the computational workflow employed to process raw sequencing reads, perform genome assembly, identify T-DNA insertion sites, and map them to the *Citrus sinensis* reference genome.

**The scripts are provided for transparency and documentation of our methodology in a forthcoming publication. They are offered "as-is" and may require significant adaptation for use with other datasets or computational environments.**

## Overview of the Bioinformatic Workflow

The analysis pipeline demonstrated by these scripts generally followed these key steps for each transgenic citrus line:

1.  **Raw Nanopore Read Processing:** Initial quality control and concatenation of raw `.fastq.gz` files from multiple Nanopore sequencing runs into single files per transgenic line.
2.  **De Novo Genome Assembly:** Using the processed Nanopore reads to generate a *de novo* genome assembly for each transgenic line. This included quality filtering and assembly quality assessment.
3.  **T-DNA Insertion Site Identification:** Searching the assembled contigs to identify sequences containing the T-DNA insertion through alignment.
4.  **Flanking Region Extraction:** Identifying and extracting the genomic regions immediately flanking the T-DNA insertion.
5.  **Chromosome Mapping:** Aligning the identified T-DNA flanking regions to the *Citrus sinensis* reference genome to pinpoint the likely chromosome and precise location of the T-DNA insertion.
6.  **Alignment Information Extraction:** Detailed extraction of metadata from alignment reports.
7.  **Alignment Information to CSV:** Conversion of extracted alignment information into a CSV format for manual review and analysis.

## Repository Contents

The scripts in this repository are designed to be run sequentially, forming a complete workflow from raw Nanopore sequencing data to the identification of T-DNA insertion sites. They are numbered to indicate their typical order of execution.

1.  `1_concat.sh`: This script consolidates raw Nanopore `.fastq.gz` files. It takes individual sequencing run outputs (typically found within `fastq_pass` subdirectories) and concatenates them into single gzipped FASTQ files for each specified transgenic line. This step is crucial for preparing data for downstream assembly.
    * *Output:* Concatenated and compressed files are saved to `MAIN_DIR/all_raw_qc10/`.

2.  `2_assemble.sh`: This script performs *de novo* genome assembly for each transgenic line using the concatenated Nanopore reads generated by `1_concat.sh`. First, it uses `filtlong` to filter sequences with a phred score mean of 15. Then, it uses `Flye` to do a genome assembly. Finally, it uses `Quast` to measure the genome assembly quality. Other polishing tools were used (Racon and Medaka), but were ultimately skipped because they did not improve the assembly for our purposes.
    * *Assumed Input:* Expects concatenated `_all_raw.qc10.fastq.gz` files from `1_concat.sh`.
    * *Output:* Assembled contigs in FASTA format) for each transgenic line.

3.  `3_align_contigs_to_TDNA.sh`: This script takes the assembled contigs from `2_assemble.sh` and aligns them against the known T-DNA sequence using `minimap`. The primary goal is to identify contigs that contain the T-DNA insertion, indicating potential insertion sites.
    * *Assumed Input:* Assembled contig files from `2_assemble.sh` and a reference T-DNA sequence database.
    * *Output:* Minimap output files detailing hits of T-DNA sequences within the contigs.

4.  `4_extract_flanking_regions.sh`: Following the identification of T-DNA containing contigs, this script extracts the genomic regions immediately flanking the T-DNA insertion using `minimap`. This typically involves parsing the alignment results from `3_align_contigs_to_TDNA.sh` to precisely define the start and end points of the flanking sequences. An accompanying Python script organizes the alignment files.
    * *Assumed Input:* Minimap output from `3_align_contigs_to_TDNA.sh`.
    * *Output:* FASTA files containing the extracted T-DNA flanking sequences.

5.  `5_map_flanking_to_reference.sh`: This script aligns the extracted T-DNA flanking regions (from `4_extract_flanking_regions.sh`) to the *Citrus sinensis* reference genome. The purpose is to pinpoint the exact chromosome and precise coordinates of the T-DNA insertion, providing genetic localization.
    * *Assumed Input:* Extracted T-DNA flanking sequences from `4_extract_flanking_regions.sh` and the *Citrus sinensis* reference genome.
    * *Output:* Alignment results (e.g., SAM/BAM files or parsed alignment reports) indicating the chromosomal location of the T-DNA insertion.

6.  `6_alignmentmetainfo_extraction.sh`: This script extracts more detailed information from the alignment reports generated in previous steps.

7.  `7_alingmentinfo_to_csv.sh`: This script extracts all relevant alignment information and formats it into a CSV file, facilitating the narrowing down of regions for manual alignment checks, here performed in the Geneious Prime software.

## Tools and Software Prerequisites

The scripts within this repository primarily rely on standard bioinformatics tools and HPC cluster modules. Key software used in this workflow includes:

* **`pigz`**: (Parallel gzip) for efficient file compression and decompression.
* **`gcc`**: Compiler often required for other bioinformatics software dependencies.
* **`filtlong`**: For filtering sequencing reads based on quality and length.
* **`Flye`**: A *de novo* assembler for long reads.
* **`Quast`**: For assessing the quality of genome assemblies.
* **`minimap`**: (Likely `minimap2`) for sequence alignment.
* **`BLAST+`**: (If also used for T-DNA alignment, as mentioned in earlier iterations).
* **`Python`**: For accompanying parsing scripts (e.g., for `4_extract_flanking_regions.sh`).
* **`samtools`**

## Important Notes & Disclaimer

* The absolute paths in all scripts are a placeholder and should be adapted to your specific file system if you attempt to re-run this script.
* These scripts were developed for a specific project and computational environment (e.g., SLURM-managed HPC cluster). Direct execution on different systems may require modifications.
